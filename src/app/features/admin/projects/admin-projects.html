<div class="projects-admin-container" [class.dark]="currentTheme === 'dark'" [class.light]="currentTheme === 'light'">
  
  <!-- Sidebar -->
  <div class="projects-admin-sidebar">
    <div class="projects-sidebar-header">
      <div class="projects-admin-logo">
        <i class="fas fa-atom"></i>
        <span>Abdallah Hany</span>
      </div>
    </div>

    <div class="projects-sidebar-nav">
      <button class="projects-nav-item" routerLink="/admin">
        <i class="fas fa-chart-pie"></i>
        <span>Dashboard</span>
      </button>
      <button class="projects-nav-item active">
        <i class="fas fa-briefcase"></i>
        <span>Projects</span>
      </button>
      <button class="projects-nav-item" routerLink="/admin/messages">
        <i class="fas fa-envelope"></i>
        <span>Messages</span>
      </button>
      <button class="projects-nav-item" routerLink="/admin/users">
        <i class="fas fa-users"></i>
        <span>Users</span>
      </button>
    </div>

    <div class="projects-sidebar-footer">
      <button class="projects-logout-btn" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="projects-admin-main">
    <!-- Header -->
    <div class="projects-header">
      <div class="projects-header-content">
        <h1>Projects Management</h1>
        <p>Manage and create portfolio projects</p>
        
        <!-- Projects Stats -->
        <div class="projects-stats" *ngIf="!isLoading">
          <div class="stat-badge">
            <span class="stat-number">{{ getProjectsStats().total }}</span>
            <span class="stat-label">Total</span>
          </div>
          <div class="stat-badge">
            <span class="stat-number">{{ getProjectsStats().published }}</span>
            <span class="stat-label">Published</span>
          </div>
          <div class="stat-badge">
            <span class="stat-number">{{ getProjectsStats().angular }}</span>
            <span class="stat-label">Angular</span>
          </div>
          <div class="stat-badge">
            <span class="stat-number">{{ getProjectsStats().backend }}</span>
            <span class="stat-label">Backend</span>
          </div>
          <div class="stat-badge">
            <span class="stat-number">{{ getProjectsStats().fullstack }}</span>
            <span class="stat-label">Full Stack</span>
          </div>
        </div>
      </div>
      <button class="projects-create-btn" (click)="openAddProjectModal()">
        <i class="fas fa-plus"></i>
        Add New Project
      </button>
    </div>

    <!-- Save Message -->
    <div class="save-message" *ngIf="saveMessage" 
         [class.success]="!saveMessage.includes('Error')"
         [class.error]="saveMessage.includes('Error')">
      <i class="fas" [class.fa-check-circle]="!saveMessage.includes('Error')" 
         [class.fa-exclamation-circle]="saveMessage.includes('Error')"></i>
      {{ saveMessage }}
    </div>

    <!-- Section Filters -->
    <div class="section-filters">
      <button class="section-filter-btn" (click)="filterProjectsBySection('all')">
        <i class="fas fa-layer-group"></i>
        All Projects
      </button>
      <button class="section-filter-btn" (click)="filterProjectsBySection('angular')">
        <i class="fab fa-angular"></i>
        Angular
      </button>
      <button class="section-filter-btn" (click)="filterProjectsBySection('backend')">
        <i class="fas fa-server"></i>
        Backend
      </button>
      <button class="section-filter-btn" (click)="filterProjectsBySection('fullstack')">
        <i class="fas fa-layer-group"></i>
        Full Stack
      </button>
    </div>

    <!-- Projects Grid -->
    <div class="projects-grid-container">
      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading projects...</p>
      </div>

      <!-- Projects List -->
      <div class="projects-grid" *ngIf="!isLoading && filteredProjects.length > 0">
        <div class="project-card" *ngFor="let project of filteredProjects" 
             [class.featured]="project.featured"
             [class.published]="project.status === 'published'">
          
          <div class="project-card-header">
            <div class="project-status">
              <!-- Section Badge -->
              <span class="section-badge" [style.background]="getSectionColor(project.section || 'fullstack')">
                <i [class]="getSectionIcon(project.section || 'fullstack')"></i>
                {{ project.section || 'Full Stack' }}
              </span>
              
              <span class="status-badge" [class.published]="project.status === 'published'">
                {{ project.status === 'published' ? 'Published' : 'Draft' }}
              </span>
              
              <span class="featured-badge" *ngIf="project.featured">
                <i class="fas fa-star"></i>
                Featured
              </span>
            </div>
            <div class="project-actions">
              <button class="action-btn edit" (click)="toggleProjectStatus(project)" 
                      title="{{ project.status === 'published' ? 'Mark as Draft' : 'Publish' }}">
                <i class="fas" [class.fa-eye-slash]="project.status === 'published'" 
                   [class.fa-eye]="project.status === 'draft'"></i>
              </button>
              <button class="action-btn feature" (click)="toggleFeaturedStatus(project)"
                      title="{{ project.featured ? 'Remove from Featured' : 'Add to Featured' }}">
                <i class="fas" [class.fa-star]="!project.featured" 
                   [class.fa-star-half-alt]="project.featured"></i>
              </button>
              <button class="action-btn copy" (click)="copyProjectLink(project._id!)" title="Copy Project Link">
                <i class="fas fa-link"></i>
              </button>
              <button class="action-btn delete" (click)="deleteProject(project._id!)" title="Delete Project">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>

          <div class="project-image">
            <img [src]="getPrimaryImage(project)" [alt]="project.title">
          </div>

          <div class="project-card-body">
            <h3 class="project-title">{{ project.title }}</h3>
            <p class="project-description">{{ project.shortDescription || project.description }}</p>
            
            <div class="project-tech">
              <span class="tech-tag" *ngFor="let tech of project.technologies.slice(0, 3)">
                {{ tech }}
              </span>
              <span class="tech-tag-more" *ngIf="project.technologies.length > 3">
                +{{ project.technologies.length - 3 }}
              </span>
            </div>

            <div class="project-links" *ngIf="project.liveUrl || project.githubUrl">
              <a *ngIf="project.liveUrl" [href]="project.liveUrl" target="_blank" class="project-link">
                <i class="fas fa-external-link-alt"></i>
                Live Demo
              </a>
              <a *ngIf="project.githubUrl" [href]="project.githubUrl" target="_blank" class="project-link">
                <i class="fab fa-github"></i>
                GitHub
              </a>
            </div>
          </div>

          <div class="project-card-footer">
            <div class="project-meta">
              <span class="meta-item">
                <i class="fas fa-calendar"></i>
                {{ project.createdAt | date:'mediumDate' }}
              </span>
              <span class="meta-item" *ngIf="project.section">
                <i [class]="getSectionIcon(project.section)"></i>
                {{ project.section }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!isLoading && filteredProjects.length === 0">
        <i class="fas fa-briefcase"></i>
        <h3>No Projects Yet</h3>
        <p>Start by adding your first project</p>
        <button class="create-first-btn" (click)="openAddProjectModal()">
          <i class="fas fa-plus"></i>
          Create First Project
        </button>
      </div>
    </div>
  </div>

  <!-- Add Project Modal -->
  <div class="modal-overlay" *ngIf="showAddProjectModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add New Project</h2>
        <button class="modal-close" (click)="closeAddProjectModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form [formGroup]="projectForm" (ngSubmit)="onSubmitProject()">
        <div class="modal-body">
          <div class="form-grid">
            <div class="form-group">
              <label>Project Title *</label>
              <input type="text" formControlName="title" class="form-input" placeholder="Enter project title">
              <div class="error-message" *ngIf="projectForm.get('title')?.touched && projectForm.get('title')?.invalid">
                Title is required (min 3 characters)
              </div>
            </div>

            <div class="form-group">
              <label>Short Description *</label>
              <textarea formControlName="shortDescription" class="form-input" rows="2" 
                        placeholder="Brief description for project card"></textarea>
              <div class="error-message" *ngIf="projectForm.get('shortDescription')?.touched && projectForm.get('shortDescription')?.invalid">
                Short description is required (min 5 characters)
              </div>
            </div>

            <div class="form-group full-width">
              <label>Full Description *</label>
              <textarea formControlName="description" class="form-input" rows="4" 
                        placeholder="Detailed project description"></textarea>
              <div class="error-message" *ngIf="projectForm.get('description')?.touched && projectForm.get('description')?.invalid">
                Description is required (min 10 characters)
              </div>
            </div>

            <!-- ✅ إضافة حقل السيكشن -->
            <div class="form-group">
              <label>Project Section *</label>
              <select formControlName="section" class="form-input">
                <option value="fullstack">Full Stack Project</option>
                <option value="angular">Angular Project</option>
                <option value="backend">Backend Project</option>
              </select>
              <div class="help-text">
                Choose the section where this project will appear
              </div>
            </div>

            <div class="form-group">
              <label>Live Demo URL</label>
              <input type="url" formControlName="liveUrl" class="form-input" 
                     placeholder="https://your-project.com">
            </div>

            <div class="form-group">
              <label>GitHub URL</label>
              <input type="url" formControlName="githubUrl" class="form-input" 
                     placeholder="https://github.com/username/repo">
            </div>

            <div class="form-group">
              <label>Status *</label>
              <select formControlName="status" class="form-input">
                <option value="draft">Draft</option>
                <option value="published">Published</option>
              </select>
            </div>

            <div class="form-group">
              <label>Featured Project</label>
              <div class="checkbox-container">
                <input type="checkbox" formControlName="featured" id="featured">
                <label for="featured">Show as featured project</label>
              </div>
            </div>

            <div class="form-group full-width">
              <label>Technologies Used</label>
              <div class="technologies-input">
                <input type="text" [(ngModel)]="newTechnology" [ngModelOptions]="{standalone: true}"
                       class="form-input" placeholder="Enter technology (e.g., Angular, React, Node.js)"
                       (keyup.enter)="addTechnology()">
                <button type="button" class="btn btn-sm" (click)="addTechnology()">
                  <i class="fas fa-plus"></i>
                  Add
                </button>
              </div>

              <div class="technologies-list" *ngIf="projectTechnologies.length > 0">
                <span class="tech-tag" *ngFor="let tech of projectTechnologies; let i = index">
                  {{ tech }}
                  <button type="button" class="tag-remove" (click)="removeTechnology(i)">
                    <i class="fas fa-times"></i>
                  </button>
                </span>
              </div>
            </div>

            <div class="form-group full-width">
              <label>Project Image</label>
              <div class="image-upload-container">
                <input type="file" #imageInput accept="image/*" (change)="onImageSelected($event)" hidden>
                
                <div class="upload-area" (click)="triggerImageUpload()" 
                     [class.has-image]="projectImagePreview">
                  
                  <div *ngIf="isUploadingImage" class="upload-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Uploading image...</p>
                  </div>

                  <div *ngIf="!isUploadingImage && !projectImagePreview" class="upload-placeholder">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Click to upload project image</p>
                    <span>Recommended: 800x600px</span>
                  </div>

                  <div *ngIf="!isUploadingImage && projectImagePreview" class="image-preview">
                    <img [src]="projectImagePreview" alt="Project preview">
                    <button type="button" class="change-image-btn" (click)="triggerImageUpload()">
                      Change Image
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" [disabled]="projectForm.invalid || isUploadingImage || isSaving">
            <i class="fas" [class.fa-save]="!isSaving" [class.fa-spinner]="isSaving" 
               [class.fa-spin]="isSaving"></i>
            {{ isSaving ? 'Creating...' : 'Create Project' }}
          </button>
          <button type="button" class="btn btn-secondary" (click)="closeAddProjectModal()">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>